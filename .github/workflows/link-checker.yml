name: Link Checker

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2
            - name: Install Node.js
              uses: actions/setup-node@v2
              with:
                node-version: '20'
            - name: Build
              run: |
                # Add your build commands here
                echo "Building project..."
                yarn install --frozen-lockfile
                yarn build 



    link-check:
        needs: build
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2
            - name: Install Node.js
              uses: actions/setup-node@v2
              with:
                node-version: '20'
            - name: Install dependencies
              run: yarn install --frozen-lockfile

            - name: Build
              run: yarn build

            - name: Restore lychee cache
              id: restore-cache
              uses: actions/cache/restore@v3
              with:
                path: .lycheecache
                key: cache-lychee-${{ github.sha }}
                restore-keys: cache-lychee-
            
            - name: Run lychee
              uses: lycheeverse/lychee-action@v1.9.0
              with:
                args: "--base . --cache --max-cache-age 1d ."
            
            - name: Save lychee cache
              uses: actions/cache/save@v3
              if: always()
              with:
                path: .lycheecache
                key: ${{ steps.restore-cache.outputs.cache-primary-key }}